sap.ui.define(["sap/m/PDFViewer","sap/ui/core/util/File"],function(e,t){"use strict";return{onAfterRendering:function(e){},onActionUploadFile:function(e){let t=this.getView();let s=sap.ui.core.Fragment.load({id:t.getId(),multiple:true,name:"br.com.tresco+
racoes.recebmanualctenfe.ext.view.Attachment",controller:this}).then(function(e){t.addDependent(e);return e});s.then(function(e){e.getContent()[0].getList().setMode("SingleSelect");e.open()})},onClose:function(e){this.byId("attachmentDialog").close();thi+
s.byId("attachmentDialog").destroy();this.getView().removeAllDependents();this.templateBaseExtension.getExtensionAPI().refreshTable()},onUploadCompleted:function(e){e.getSource().removeAllIncompleteItems();e.getSource().getBinding("items").refresh();this+
.templateBaseExtension.getExtensionAPI().refreshTable();if(e.getSource().getItems().length===0)this.onClose()},onFileTypeMismatch:function(e){sap.m.MessageBox.error("Extesão do arquivo não suportado")},onSelectAllAttachments:function(e){var t=this.byId("+
UploadSet").getItems(),s=e.getSource().getSelected();t.forEach(e=>e.getListItem().setSelected(s));this.byId("download").setEnabled(s);this.byId("remove").setEnabled(s)},onSelectionChangeAttachment:function(){if(this.byId("UploadSet").getList().getSelecte+
dItems().length>0){this.byId("remove").setEnabled(true);this.byId("download").setEnabled(true)}else{this.byId("remove").setEnabled(false);this.byId("download").setEnabled(false)}},onAfterItemAdded:function(e){if(e.getSource().getList().getSelectedItems()+
.length>0)this.byId("remove").setEnabled(true);else this.byId("remove").setEnabled(true);e.getParameter("item").setVisibleEdit(false);this.byId("btnOk").setEnabled(true)},onRemove(e){sap.m.MessageBox.confirm(this.getOwnerComponent().getModel("i18n").getR+
esourceBundle().getText("deleteMsg"),{icon:"sap-icon://alert",title:this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("deleteTitle"),onClose:function(e){switch(e){case"OK":let e=this.byId("UploadSet");e.setBusy(true);e.getItems().forE+
ach(t=>{if(t.getListItem().getSelected()){let s=t.getBindingContext().getObject().Guid;this.getView().getModel("fileService").remove("/documentSet(Guid=guid'"+s+"')",{success:function(){e.removeItem(t);e.getBinding("items").refresh()},error:function(e){}+
})}});e.setBusy(false);break;default:break}}.bind(this)})},onDownload(e){let t=this.byId("UploadSet");t.setBusy(true);let s=window.location.origin+this.getView().getModel("fileService").sServiceUrl;t.getItems().forEach(e=>{if(e.getListItem().getSelected(+
)){let t=e.getBindingContext().getObject().Guid;sap.m.URLHelper.redirect(s+"/documentSet(Guid=guid'"+t+"')/$value",true)}});t.setBusy(false)},getDate(e){return new Date(e).toLocaleString()},getIcon:function(e){let t;let s=e.split(".").pop();switch(s.toUp+
perCase()){case"DOC":case"DOCX":t="sap-icon://doc-attachment";break;case"XLS":case"XLSX":t="sap-icon://excel-attachment";break;case"PDF":t="sap-icon://pdf-attachment";break;case"PPT":case"PPTX":t="sap-icon://ppt-attachment";break;case"TXT":t="sap-icon://+
attachment-text-file";break;case"JPG":case"JPEG":case"PNG":t="sap-icon://attachment-photo";break;default:t="sap-icon://attachment";break}return t},onAccept:function(e){sap.m.MessageBox.confirm(this.getOwnerComponent().getModel("i18n").getResourceBundle()+
.getText("confirmMsg"),{title:this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("confirmTitle"),onClose:function(e){switch(e){case"OK":this.uploadItem();break;default:this.onClose();break}}.bind(this)})},uploadItem:function(e){let t=t+
his.byId("UploadSet");for(let e of t.getIncompleteItems()){let o=new sap.ui.core.Item({key:"X-CSRF-Token",text:this.getOwnerComponent().getModel().getSecurityToken()});let a=new sap.ui.core.Item({key:"SLUG",text:e.getProperty("fileName")});var s=this.cre+
ate_uuid();if(this.byId("nfe").getSelected()){var n="1"}else{var n="2"}let i=new sap.ui.core.Item({key:"Guid",text:s});let r=new sap.ui.core.Item({key:"Doctype",text:n});t.addHeaderField(o).addHeaderField(a).addHeaderField(i).addHeaderField(r).uploadItem+
(e);t.removeAllHeaderFields()}},create_uuid(){var e=(new Date).getTime();var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var s=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(t=="x"?s:s&3|8).toString(16)});return t},onActionD+
ownloadFile:function(t){let s=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();if(!s.length){sap.m.MessageToast.show("Nenhum registro selecionado.");return}if(s.length>1){alert("Favor selecionar apenas um registro.");return}var n="downl+
oadPDFSet(Guid='"+s[0].getObject().Guid+"')/$value";var o="/sap/opu/odata/sap/ZTM_RECEB_MANUAL_CTE_NFE_SRV/";var a=o+n;var i=new e;this.getView().addDependent(i);i.setSource(a);i.downloadPDF()},onActionDownloadFile2:function(e){let s=this.templateBaseExt+
ension.getExtensionAPI().getSelectedContexts();if(!s.length){sap.m.MessageToast.show("Nenhum registro selecionado.");return}if(s.length>1){alert("Favor selecionar apenas um registro.");return}var n="downloadSet(Guid='"+s[0].getObject().Guid+"')";var o="/+
sap/opu/odata/sap/ZTM_RECEB_MANUAL_CTE_NFE_SRV/";var a=new sap.ui.model.odata.ODataModel(o,false);var i=function(){return new Promise(function(e,s){a.read(n,{success:function(s,n){e();t.save(atob(s.Value),s.Filename.split(".")[0],s.Filename.split(".")[1]+
,s.Mimetype,"UTF-8",null,null)}.bind(this),error:function(e){s();this.showLog(e.response.body);this.templateBaseExtension.getExtensionAPI().refreshTable()}.bind(this)})}.bind(this))}.bind(this);var r={dataloss:false};this.extensionAPI.securedExecution(i,+
r)},showLog:function(e){let t=[];for(const s of e.matchAll(/(?:<message>(.*?)<[/]message>)/gm)){t.push(s[1])}let s=[];for(const t of e.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)){switch(t[1]){case"error":s.push(sap.ui.core.MessageType.Error);break;ca+
se"info":s.push(sap.ui.core.MessageType.Information);break;case"success":s.push(sap.ui.core.MessageType.Success);break;case"warning":s.push(sap.ui.core.MessageType.Warning);break;default:s.push(sap.ui.core.MessageType.None);break}}for(let e=0;e<t.length;+
e++){if(t[e]=="Ocorreu uma exceção"){continue}sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({message:t[e],persistent:true,type:s[e]}))}}}});                                                                                