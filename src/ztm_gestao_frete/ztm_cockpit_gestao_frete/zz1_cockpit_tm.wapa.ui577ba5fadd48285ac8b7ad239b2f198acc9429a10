sap.ui.define(                                                                                                                                                                                                                                                 
    ["sap/m/PDFViewer",                                                                                                                                                                                                                                        
        "sap/ui/core/util/File"],                                                                                                                                                                                                                              
    function (PDFViewer, File) {                                                                                                                                                                                                                               
        "use strict";                                                                                                                                                                                                                                          
        return {                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            onActionDownloadFile: function (oEvent) {                                                                                                                                                                                                          
                var that = this                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupa referência à tabela do relatório                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                if (!oItems.length) {                                                                                                                                                                                                                          
                    alert('Nenhuma linha selecionada');                                                                                                                                                                                                        
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Verifica as linhas selecionadas se são NFE, CTE ou ambas                                                                                                                                                                                       
                =================================================================== */                                                                                                                                                                         
                var vCTE = false;                                                                                                                                                                                                                              
                var vNFE = false;                                                                                                                                                                                                                              
                var vNFS = false;                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                for (let i = 0; i < oItems.length; i++) {                                                                                                                                                                                                      
                    if (oItems[i].getObject().tpdoc == 'CTE') {                                                                                                                                                                                                
                        vCTE = true;                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                    if (oItems[i].getObject().tpdoc == 'NFE') {                                                                                                                                                                                                
                        vNFE = true;                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                    if (oItems[i].getObject().tpdoc == 'NFS') {                                                                                                                                                                                                
                        vNFS = true;                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                let vRadio = new sap.m.RadioButtonGroup({                                                                                                                                                                                                      
                    id: "rbg3"                                                                                                                                                                                                                                 
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                if (vCTE) {                                                                                                                                                                                                                                    
                    vRadio.addButton(new sap.m.RadioButton({                                                                                                                                                                                                   
                        id: "xml_cte",                                                                                                                                                                                                                         
                        text: "XML CTE"                                                                                                                                                                                                                        
                    }));                                                                                                                                                                                                                                       
                    vRadio.addButton(new sap.m.RadioButton({                                                                                                                                                                                                   
                        id: "pdf_cte",                                                                                                                                                                                                                         
                        text: "PDF CTE"                                                                                                                                                                                                                        
                    }));                                                                                                                                                                                                                                       
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (vNFE) {                                                                                                                                                                                                                                    
                    vRadio.addButton(new sap.m.RadioButton({                                                                                                                                                                                                   
                        id: "xml_nfe",                                                                                                                                                                                                                         
                        text: "XML NFE"                                                                                                                                                                                                                        
                    }));                                                                                                                                                                                                                                       
                    vRadio.addButton(new sap.m.RadioButton({                                                                                                                                                                                                   
                        id: "pdf_nfe",                                                                                                                                                                                                                         
                        text: "PDF NFE"                                                                                                                                                                                                                        
                    }));                                                                                                                                                                                                                                       
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (vNFS) {                                                                                                                                                                                                                                    
                    vRadio.addButton(new sap.m.RadioButton({                                                                                                                                                                                                   
                        id: "pdf_nfs",                                                                                                                                                                                                                         
                        text: "PDF NFS"                                                                                                                                                                                                                        
                    }));                                                                                                                                                                                                                                       
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                              
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Text({ text: "Selecione o tipo de download desejado" }),                                                                                                                                                                     
                        new sap.m.Text({ text: ' ' }),                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        vRadio,                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        new sap.m.Text({ text: ' ' })                                                                                                                                                                                                          
                    ]                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                var pressDialog = new sap.m.Dialog({                                                                                                                                                                                                           
                    type: 'Message',                                                                                                                                                                                                                           
                    title: "Download Informações",                                                                                                                                                                                                             
                    resizable: true,                                                                                                                                                                                                                           
                    draggable: true,                                                                                                                                                                                                                           
                    titleAlignment: sap.m.TitleAlignment.Center,                                                                                                                                                                                               
                    content: oContent,                                                                                                                                                                                                                         
                    beginButton: new sap.m.Button({                                                                                                                                                                                                            
                        type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                     
                        text: "Processar",                                                                                                                                                                                                                     
                        press: function () {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().byId('pdf_nfe')) {                                                                                                                                                                                            
                                if (sap.ui.getCore().byId('pdf_nfe').getSelected()) {                                                                                                                                                                          
                                    var vDoctype = '1';                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().byId('pdf_nfs')) {                                                                                                                                                                                            
                                if (sap.ui.getCore().byId('pdf_nfs').getSelected()) {                                                                                                                                                                          
                                    var vDoctype = '1';                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().byId('pdf_cte')) {                                                                                                                                                                                            
                                if (sap.ui.getCore().byId('pdf_cte').getSelected()) {                                                                                                                                                                          
                                    var vDoctype = '2';                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().byId('xml_nfe')) {                                                                                                                                                                                            
                                if (sap.ui.getCore().byId('xml_nfe').getSelected()) {                                                                                                                                                                          
                                    var vDoctype = '4';                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().byId('xml_cte')) {                                                                                                                                                                                            
                                if (sap.ui.getCore().byId('xml_cte').getSelected()) {                                                                                                                                                                          
                                    var vDoctype = '5';                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            pressDialog.close();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            /* ===================================================================&nbsp;                                                                                                                                                       
                            Recupa referência à tabela do relatório                                                                                                                                                                                            
                            =================================================================== */                                                                                                                                                             
                            var oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                   
                            var oServiceUrl = "/sap/opu/odata/SAP/ZTM_DOWNLOAD_GESTAO_FRETE_SRV/";                                                                                                                                                             
                            var oModel = new sap.ui.model.odata.ODataModel(oServiceUrl, false);                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            /* ===================================================================&nbsp;                                                                                                                                                       
                            Recupera PDFs das linhas selecionadas                                                                                                                                                                                              
                            =================================================================== */                                                                                                                                                             
                            for (let i = 0; i < oItems.length; i++) {                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                /* ===================================================================&nbsp;                                                                                                                                                   
                                Verifica se Arquivo existe para determinado Tipo (Doctype):                                                                                                                                                                    
                                1 - NFE                                                                                                                                                                                                                        
                                2 - CCE                                                                                                                                                                                                                        
                                3 - BOLETO                                                                                                                                                                                                                     
                                4 - MDFE                                                                                                                                                                                                                       
                                =================================================================== */                                                                                                                                                         
                                //var oObject = oItems[i].getBindingContext().getObject();                                                                                                                                                                     
                                var oObject = oItems[i].getObject();                                                                                                                                                                                           
                                var vSourceRead = "downloadCheckSet(Acckey='" + oObject.acckey + "',Doctype='" + vDoctype + "')"                                                                                                                               
                                                                                                                                                                                                                                                               
                                var waitFunction = async function () {                                                                                                                                                                                         
                                    // first code block ...                                                                                                                                                                                                    
                                    await delay(5000);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                    // some more code, executed 5 seconds after the first code block finishes                                                                                                                                                  
                                };                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                var fnFunction = function () {                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                        //oModel.read(vSourceRead, null, null, true,                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                        oModel.read(vSourceRead, {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                            success: function (oData, oResponse) {                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                                showSuccessMessage();                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                                if (!oData.Exist) {                                                                                                                                                                                            
                                                    return;                                                                                                                                                                                                    
                                                }                                                                                                                                                                                                              
                                                //sap.ui.core.util.File.save(oData.Value, 'device', 'pdf', 'application/pdf', 'utf-8', false);                                                                                                                 
                                                var oSource = oServiceUrl + "downloadSet(Acckey='" + oData.Acckey + "',Doctype='" + oData.Doctype + "',Auto='X')/$value";                                                                                      
                                                var oPDFViewer = new PDFViewer();                                                                                                                                                                              
                                                this.getView().addDependent(oPDFViewer);                                                                                                                                                                       
                                                oPDFViewer.setSource(oSource);                                                                                                                                                                                 
                                                oPDFViewer.downloadPDF();                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                            }.bind(this),                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                            error: function (oError) {                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                showErrorMessage();                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                            }.bind(this),                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                        });                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                    }.bind(this))                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                }.bind(this);                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                /* ===================================================================&nbsp;                                                                                                                                                   
                                Configura pop-up de mensagens                                                                                                                                                                                                  
                                =================================================================== */                                                                                                                                                         
                                this.extensionAPI.securedExecution(waitFunction,                                                                                                                                                                               
                                    {                                                                                                                                                                                                                          
                                        busy: {                                                                                                                                                                                                                
                                            set: true,                                                                                                                                                                                                         
                                            check: false                                                                                                                                                                                                       
                                        },                                                                                                                                                                                                                     
                                        sActionLabel: "Mensagens"                                                                                                                                                                                              
                                    });                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                this.extensionAPI.securedExecution(fnFunction,                                                                                                                                                                                 
                                    {                                                                                                                                                                                                                          
                                        busy: {                                                                                                                                                                                                                
                                            set: true,                                                                                                                                                                                                         
                                            check: false                                                                                                                                                                                                       
                                        },                                                                                                                                                                                                                     
                                        sActionLabel: "Mensagens"                                                                                                                                                                                              
                                    });                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                        }.bind(this)                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    }),                                                                                                                                                                                                                                        
                    endButton: new sap.m.Button({                                                                                                                                                                                                              
                        text: "Cancelar",                                                                                                                                                                                                                      
                        press: function () {                                                                                                                                                                                                                   
                            pressDialog.close();                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    afterClose: function () {                                                                                                                                                                                                                  
                        pressDialog.destroy();                                                                                                                                                                                                                 
                    },                                                                                                                                                                                                                                         
                    contentWidth: "20%",                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                pressDialog.open();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showSuccessMessage: function (sMessage) {                                                                                                                                                                                                          
                this.getView().setBusy(false);                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showErrorMessage: function (sMessage) {                                                                                                                                                                                                            
                this.getView().setBusy(false);                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            delay: function (time) {                                                                                                                                                                                                                           
                return new Promise(resolve => setTimeout(resolve, time));                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionAttachment: function (oEvent) {                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupera primeira linha selecionada                                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Verifica as linhas selecionadas                                                                                                                                                                                                                
                =================================================================== */                                                                                                                                                                         
                if (!oItems.length) {                                                                                                                                                                                                                          
                    sap.m.MessageToast.show("Nenhum registro selecionado.");                                                                                                                                                                                   
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /*                                                                                                                                                                                                                                             
                if (oItems.length > 1) {                                                                                                                                                                                                                       
                    alert("Favor selecionar apenas um registro.");                                                                                                                                                                                             
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                */                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                for (let i = 0; i < oItems.length; i++) {                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    if (!oItems[i].getObject().FreightOrder) {                                                                                                                                                                                                 
                        alert("Registro sem ordem de frete.");                                                                                                                                                                                                 
                        return;                                                                                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (oItems[i].getObject().tpdoc == 'CTE') {                                                                                                                                                                                                
                        if (oItems[i].getObject().cfop == '' ||                                                                                                                                                                                                
                            oItems[i].getObject().cfop == '0') {                                                                                                                                                                                               
                            alert("Campo CFOP deve estar preenchido");                                                                                                                                                                                         
                            return;                                                                                                                                                                                                                            
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (!oItems[i].getObject().cfop_ok) {                                                                                                                                                                                                      
                        alert("CFOP " + oItems[i].getObject().cfop + " não cadastrado na tabela de configuração");                                                                                                                                             
                        return;                                                                                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                   Configura Serviço OData onde será extraído os dados                                                                                                                                                                                         
                   =================================================================== */                                                                                                                                                                      
                var vServiceUrl = "/sap/opu/odata/sap/ZUI_O2_COCKPIT_FRETE";                                                                                                                                                                                   
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                switch (oItems[0].getObject().tpdoc) {                                                                                                                                                                                                         
                    case "CTE":                                                                                                                                                                                                                                
                        var vView = "/ZI_TM_VH_ATT_SCH1";                                                                                                                                                                                                      
                        break;                                                                                                                                                                                                                                 
                    case "NFE":                                                                                                                                                                                                                                
                        var vView = "/ZI_TM_VH_ATT_SCH1_NFS";                                                                                                                                                                                                  
                        break;                                                                                                                                                                                                                                 
                    case "NFS":                                                                                                                                                                                                                                
                        var vView = "/ZI_TM_VH_ATT_SCH1_NFS";                                                                                                                                                                                                  
                        break;                                                                                                                                                                                                                                 
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Serviço                                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                oModel.read(vView, {                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    success: function (oData) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        if (oData.results.length > 0)                                                                                                                                                                                                          
                            this.attachmentPopUp(oData.results);                                                                                                                                                                                               
                        else                                                                                                                                                                                                                                   
                            alert('Nenhum tipo de anexo encontrado para esquema TM_COCKPIT');                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    }.bind(this),                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    error: function (oError) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                        alert('Nenhum tipo de anexo encontrado para esquema TM_COCKPIT');                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            attachmentPopUp: function (Results) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupera primeira linha selecionada                                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria Diálogo dinâmico (pop-up)                                                                                                                                                                                                                 
                =================================================================== */                                                                                                                                                                         
                var oUploadDialog = new sap.m.Dialog({                                                                                                                                                                                                         
                    contentWidth: "400px",                                                                                                                                                                                                                     
                    resizable: true,                                                                                                                                                                                                                           
                    type: "Message",                                                                                                                                                                                                                           
                    escapeHandler: function (oPromise) {                                                                                                                                                                                                       
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                oUploadDialog.setTitle("Inserir file");                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Define o serviço gateway que será chamado                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                var sServiceUrl = "/sap/opu/odata/SAP/ZTM_GESTAO_FRETE_ANEXO_SRV/";                                                                                                                                                                            
                var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, false);                                                                                                                                                                            
                var sEntity = sServiceUrl + "uploadFileSet";                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Prepara o responsável pela carga do arquivo                                                                                                                                                                                                    
                =================================================================== */                                                                                                                                                                         
                var oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                          
                    width: "100%",                                                                                                                                                                                                                             
                    //typeMissmatch: this.handleTypeMissmatch,                                                                                                                                                                                                 
                    uploadComplete: function (oEvent) {                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        // Atualiza tabela do relatório após carga                                                                                                                                                                                             
                        this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        // Verifica o retorno da mensagem                                                                                                                                                                                                      
                        if (oEvent.mParameters.status == '200' ||                                                                                                                                                                                              
                            oEvent.mParameters.status == '201') {                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            sap.m.MessageToast.show("Arquivo anexado com sucesso.");                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                        else {                                                                                                                                                                                                                                 
                            let aMessage = [];                                                                                                                                                                                                                 
                            for (const res of oEvent.mParameters.responseRaw.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                   
                                aMessage.push(res[1]);                                                                                                                                                                                                         
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (aMessage[0]) {                                                                                                                                                                                                                 
                                sap.m.MessageBox.error(aMessage[0]);                                                                                                                                                                                           
                            } else {                                                                                                                                                                                                                           
                                sap.m.MessageBox.error(oEvent.mParameters.response);                                                                                                                                                                           
                            }                                                                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
               Define parâmetros                                                                                                                                                                                                                               
                =================================================================== */                                                                                                                                                                         
                oFileUploader.setName("Simple Uploader");                                                                                                                                                                                                      
                oFileUploader.setUploadUrl(sEntity);                                                                                                                                                                                                           
                oFileUploader.setSendXHR(true);                                                                                                                                                                                                                
                oFileUploader.setUseMultipart(false);                                                                                                                                                                                                          
                oFileUploader.setUploadOnChange(false);                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                var oToken = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                                        
                    name: "x-csrf-token",                                                                                                                                                                                                                      
                    value: oModel.getSecurityToken()                                                                                                                                                                                                           
                });                                                                                                                                                                                                                                            
                oFileUploader.insertHeaderParameter(oToken);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Monta lista de tipos de anexo                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                //let oList = [];                                                                                                                                                                                                                              
                //oList.push({ Key: 'ATCMT', Text: 'Anexo' });                                                                                                                                                                                                 
                ///oList.push({ Key: 'CGNRE', Text: 'Comprovante de pagamento Guia GNRE' });                                                                                                                                                                   
                //oList.push({ Key: 'GNRE', Text: 'Guia GNRE' });                                                                                                                                                                                              
                //oList.push({ Key: 'IBDOC', Text: 'Documento de entrada' });                                                                                                                                                                                  
                //oList.push({ Key: 'LEGAL', Text: 'Documentos legais' });                                                                                                                                                                                     
                //oList.push({ Key: 'LINK', Text: 'Ligação' });                                                                                                                                                                                                
                //oList.push({ Key: 'NFS', Text: 'PDF Nota Fiscal de Serviço' });                                                                                                                                                                              
                //oList.push({ Key: 'OBDOC', Text: 'Documento de saída' });                                                                                                                                                                                    
                //oList.push({ Key: 'RATE', Text: 'Tabela de preços de tarifa dos custos de transporte' });                                                                                                                                                    
                                                                                                                                                                                                                                                               
                var oComboBox = new sap.m.ComboBox({                                                                                                                                                                                                           
                    id: 'idType',                                                                                                                                                                                                                              
                    items: {                                                                                                                                                                                                                                   
                        path: '/items',                                                                                                                                                                                                                        
                        //Configura nome das colunas                                                                                                                                                                                                           
                        template: new sap.ui.core.ListItem({                                                                                                                                                                                                   
                            key: "{AttachmentType}",                                                                                                                                                                                                           
                            text: "{AttachmentTypeText}",                                                                                                                                                                                                      
                            additionalText: "{AttachmentType}"                                                                                                                                                                                                 
                        }),                                                                                                                                                                                                                                    
                        templateShareable: false                                                                                                                                                                                                               
                    },                                                                                                                                                                                                                                         
                    showSecondaryValues: true                                                                                                                                                                                                                  
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                oComboBox.setModel(new sap.ui.model.json.JSONModel({ items: Results }));                                                                                                                                                                       
                //oComboBox.setModel(new sap.ui.model.json.JSONModel({ items: oList }));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Campo para inserir descrição                                                                                                                                                                                                                   
                =================================================================== */                                                                                                                                                                         
                var oInput = new sap.m.Input('idDescription', {                                                                                                                                                                                                
                    width: '100%',                                                                                                                                                                                                                             
                    value: "",                                                                                                                                                                                                                                 
                    editable: true                                                                                                                                                                                                                             
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botão de cancelar                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var oCancelButton = new sap.m.Button({                                                                                                                                                                                                         
                    text: 'Cancelar',                                                                                                                                                                                                                          
                    type: 'Reject',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                        this.getView().removeAllDependents();                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botão para a carga do arquivo                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                        
                    text: 'OK',                                                                                                                                                                                                                                
                    type: 'Accept',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        // Verifica se arquivo foi informado                                                                                                                                                                                                   
                        var domRef = oFileUploader.getFocusDomRef();                                                                                                                                                                                           
                        var file = domRef.files[0];                                                                                                                                                                                                            
                        var sFileName = oFileUploader.getValue();                                                                                                                                                                                              
                        if (!sFileName) {                                                                                                                                                                                                                      
                            alert("Favor selecionar um arquivo");                                                                                                                                                                                              
                            return;                                                                                                                                                                                                                            
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        // Verifica se tipo de arquivo foi informado                                                                                                                                                                                           
                        var vAttachamentType = sap.ui.getCore().byId('idType').getSelectedKey()                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        if (!vAttachamentType) {                                                                                                                                                                                                               
                            alert("Favor preencher campos obrigatórios.");                                                                                                                                                                                     
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        // Verifica se texto foi informado                                                                                                                                                                                                     
                        if (sap.ui.getCore().byId('idDescription')) {                                                                                                                                                                                          
                            var vName = sap.ui.getCore().byId('idDescription').getValue();                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            if (!vName) {                                                                                                                                                                                                                      
                                alert("Favor preencher campos obrigatórios.");                                                                                                                                                                                 
                            }                                                                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var oContentType = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                          
                            name: "Content-Type",                                                                                                                                                                                                              
                            value: file.type                                                                                                                                                                                                                   
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        oFileUploader.insertHeaderParameter(oContentType);                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        debugger;                                                                                                                                                                                                                              
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                               
                        for (let i = 0; i < oItems.length; i++) {                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            oFileUploader.insertHeaderParameter(new sap.ui.unified.FileUploaderParameter({                                                                                                                                                     
                                name: "SLUG",                                                                                                                                                                                                                  
                                value: oItems[i].getObject().acckey + ";" + oFileUploader.getValue() + ";" + vAttachamentType + ";" + vName                                                                                                                    
                            }));                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            oFileUploader.upload();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama diálogo com a lógica de carga&nbsp;                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                oUploadDialog.addContent(new sap.ui.layout.VerticalLayout({                                                                                                                                                                                    
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Label({ text: "Tipo de anexo:", required: true }),                                                                                                                                                                           
                        oComboBox,                                                                                                                                                                                                                             
                    ]                                                                                                                                                                                                                                          
                }));                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                oUploadDialog.addContent(new sap.ui.layout.VerticalLayout({                                                                                                                                                                                    
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Label({ text: "Descrição:", required: true }),                                                                                                                                                                               
                        oInput,                                                                                                                                                                                                                                
                    ]                                                                                                                                                                                                                                          
                }));                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                oUploadDialog.addContent(new sap.ui.layout.VerticalLayout({                                                                                                                                                                                    
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Label({ text: "Conteúdo:", required: true }),                                                                                                                                                                                
                        oFileUploader,                                                                                                                                                                                                                         
                    ]                                                                                                                                                                                                                                          
                }));                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                oUploadDialog.setBeginButton(oTriggerButton);                                                                                                                                                                                                  
                oUploadDialog.setEndButton(oCancelButton);                                                                                                                                                                                                     
                oUploadDialog.open();                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionDownloadAttachment: function (oEvent) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupera primeira linha selecionada                                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Verifica as linhas selecionadas                                                                                                                                                                                                                
                =================================================================== */                                                                                                                                                                         
                if (!oItems.length) {                                                                                                                                                                                                                          
                    sap.m.MessageToast.show("Nenhum registro selecionado.");                                                                                                                                                                                   
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (oItems.length > 1) {                                                                                                                                                                                                                       
                    alert("Favor selecionar apenas um registro.");                                                                                                                                                                                             
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (!oItems[0].getObject().FreightOrder) {                                                                                                                                                                                                     
                    alert("Registro sem ordem de frete.");                                                                                                                                                                                                     
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                var entitySet = "getFileListSet";                                                                                                                                                                                                              
                var vServiceUrl = "/sap/opu/odata/SAP/ZTM_GESTAO_FRETE_ANEXO_SRV/";                                                                                                                                                                            
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                let aFilters = [];                                                                                                                                                                                                                             
                let oFilter = new sap.ui.model.Filter({                                                                                                                                                                                                        
                    filters: [new sap.ui.model.Filter('acckey', sap.ui.model.FilterOperator.EQ, oItems[0].getObject().acckey)],                                                                                                                                
                    and: true                                                                                                                                                                                                                                  
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                aFilters.push(oFilter);                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Gateway para processar logs                                                                                                                                                                                                              
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oModel.read(entitySet, {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            filters: aFilters,                                                                                                                                                                                                                 
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                showSuccessMessage();                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                this.downloadAttachment(oData.results);                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                showErrorMessage();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                this.showLog(oError.response.body);                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                this.extensionAPI.securedExecution(fnFunction,                                                                                                                                                                                                 
                    {                                                                                                                                                                                                                                          
                        busy: {                                                                                                                                                                                                                                
                            set: true,                                                                                                                                                                                                                         
                            check: false                                                                                                                                                                                                                       
                        },                                                                                                                                                                                                                                     
                        sActionLabel: "Mensagens"                                                                                                                                                                                                              
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showLog: function (sMessage) {                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                // Recupera texto da mensagem                                                                                                                                                                                                                  
                let aMessage = [];                                                                                                                                                                                                                             
                for (const res of sMessage.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                                                     
                    aMessage.push(res[1]);                                                                                                                                                                                                                     
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // Recupera o tipo da mensagem                                                                                                                                                                                                                 
                let aSeverity = [];                                                                                                                                                                                                                            
                for (const res of sMessage.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)) {                                                                                                                                                                   
                    switch (res[1]) {                                                                                                                                                                                                                          
                        case "error":                                                                                                                                                                                                                          
                            aSeverity.push(sap.ui.core.MessageType.Error);                                                                                                                                                                                     
                            break;                                                                                                                                                                                                                             
                        case "info":                                                                                                                                                                                                                           
                            aSeverity.push(sap.ui.core.MessageType.Information);                                                                                                                                                                               
                            break;                                                                                                                                                                                                                             
                        case "success":                                                                                                                                                                                                                        
                            aSeverity.push(sap.ui.core.MessageType.Success);                                                                                                                                                                                   
                            break;                                                                                                                                                                                                                             
                        case "warning":                                                                                                                                                                                                                        
                            aSeverity.push(sap.ui.core.MessageType.Warning);                                                                                                                                                                                   
                            break;                                                                                                                                                                                                                             
                        default:                                                                                                                                                                                                                               
                            aSeverity.push(sap.ui.core.MessageType.None);                                                                                                                                                                                      
                            break;                                                                                                                                                                                                                             
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // Exibe mensagem                                                                                                                                                                                                                              
                for (let i = 0; i < aMessage.length; i++) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    if (aMessage[i] == "Ocorreu uma exceção") {                                                                                                                                                                                                
                        continue;                                                                                                                                                                                                                              
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    //MessageManager.addMessages(new sap.ui.core.message.Message({                                                                                                                                                                             
                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                                         
                        message: aMessage[i],                                                                                                                                                                                                                  
                        persistent: true, // create message as transition message                                                                                                                                                                              
                        type: aSeverity[i]                                                                                                                                                                                                                     
                    }));                                                                                                                                                                                                                                       
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            downloadAttachment: function (Results) {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura lista Dropdown                                                                                                                                                                                                                       
                =================================================================== */                                                                                                                                                                         
                var oComboBox = new sap.m.ComboBox({                                                                                                                                                                                                           
                    id: 'oComboBox',                                                                                                                                                                                                                           
                    items: {                                                                                                                                                                                                                                   
                        path: '/items',                                                                                                                                                                                                                        
                        //Configura nome das colunas                                                                                                                                                                                                           
                        template: new sap.ui.core.ListItem({                                                                                                                                                                                                   
                            key: "{acckey};{filekey}",                                                                                                                                                                                                         
                            text: "{name}",                                                                                                                                                                                                                    
                            additionalText: "{atctype}"                                                                                                                                                                                                        
                        }),                                                                                                                                                                                                                                    
                        templateShareable: false                                                                                                                                                                                                               
                    },                                                                                                                                                                                                                                         
                    showSecondaryValues: true                                                                                                                                                                                                                  
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                // Adiciona tabela como lista                                                                                                                                                                                                                  
                oComboBox.setModel(new sap.ui.model.json.JSONModel({ items: Results }));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura conteúdo do Pop-up                                                                                                                                                                                                                   
                =================================================================== */                                                                                                                                                                         
                var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                              
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Text({ text: "Selecione o arquivo para baixar:" }),                                                                                                                                                                          
                        new sap.m.Text({ text: ' ' }),                                                                                                                                                                                                         
                        oComboBox                                                                                                                                                                                                                              
                    ]                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura botão de impressão                                                                                                                                                                                                                   
                =================================================================== */                                                                                                                                                                         
                var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                        
                    type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                         
                    text: "Baixar",                                                                                                                                                                                                                            
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        var vLine = sap.ui.getCore().byId('oComboBox').getSelectedKey();                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        if (!vLine) {                                                                                                                                                                                                                          
                            sap.m.MessageBox.warning("Favor escolher arquivo para baixar")                                                                                                                                                                     
                        }                                                                                                                                                                                                                                      
                        else {                                                                                                                                                                                                                                 
                            pressDialog.close();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            var vAcckey = vLine.split(";")[0];                                                                                                                                                                                                 
                            var vFilekey = vLine.split(";")[1];                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            that.downloadFile(vAcckey, vFilekey);                                                                                                                                                                                              
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botão de cancelar                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var oCancelButton = new sap.m.Button({                                                                                                                                                                                                         
                    text: 'Cancelar',                                                                                                                                                                                                                          
                    type: 'Reject',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                        pressDialog.close();                                                                                                                                                                                                                   
                        pressDialog.destroy();                                                                                                                                                                                                                 
                        this.getView().removeAllDependents();                                                                                                                                                                                                  
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria janela pop-up                                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var pressDialog = new sap.m.Dialog({                                                                                                                                                                                                           
                    type: 'Message',                                                                                                                                                                                                                           
                    title: "Baixar arquivo",                                                                                                                                                                                                                   
                    resizable: true,                                                                                                                                                                                                                           
                    draggable: true,                                                                                                                                                                                                                           
                    titleAlignment: sap.m.TitleAlignment.Center,                                                                                                                                                                                               
                    content: oContent,                                                                                                                                                                                                                         
                    beginButton: oTriggerButton,                                                                                                                                                                                                               
                    endButton: oCancelButton,                                                                                                                                                                                                                  
                    afterClose: function () {                                                                                                                                                                                                                  
                        pressDialog.destroy();                                                                                                                                                                                                                 
                    },                                                                                                                                                                                                                                         
                    contentWidth: "20%",                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama janela pop-up                                                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                pressDialog.open();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            downloadFile: function (acckey, filekey) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                var vEntitySet = "downloadPDFSet(acckey='" + acckey + "',filekey='" + filekey + "')/$value";                                                                                                                                                   
                var vServiceUrl = "/sap/opu/odata/SAP/ZTM_GESTAO_FRETE_ANEXO_SRV/";                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oSource = vServiceUrl + vEntitySet;                                                                                                                                                                                                        
                var oPDFViewer = new PDFViewer();                                                                                                                                                                                                              
                this.getView().addDependent(oPDFViewer);                                                                                                                                                                                                       
                oPDFViewer.setSource(oSource);                                                                                                                                                                                                                 
                oPDFViewer.downloadPDF();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            downloadFile2: function (acckey, filekey) {                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                var entitySet = "downloadFileSet(acckey='" + acckey + "',filekey='" + filekey + "')";                                                                                                                                                          
                var vServiceUrl = "/sap/opu/odata/SAP/ZTM_GESTAO_FRETE_ANEXO_SRV/";                                                                                                                                                                            
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Gateway para processar logs                                                                                                                                                                                                              
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oModel.read(entitySet, {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                showSuccessMessage();                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                File.save(atob(oData.value), oData.filename.split(".")[0], oData.filename.split(".")[1], oData.mimetype, "UTF-8", null, null);                                                                                                 
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                showErrorMessage();                                                                                                                                                                                                            
                                this.showLog(oError.response.body);                                                                                                                                                                                            
                                this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                var mParameters = {                                                                                                                                                                                                                            
                    dataloss: false                                                                                                                                                                                                                            
                };                                                                                                                                                                                                                                             
                this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               