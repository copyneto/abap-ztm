sap.ui.define(["sap/m/PDFViewer"],                                                                                                                                                                                                                             
function (PDFViewer){                                                                                                                                                                                                                                          
    "use strict";                                                                                                                                                                                                                                              
    return {                                                                                                                                                                                                                                                   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
        onInit: function (oEvent) {                                                                                                                                                                                                                            
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onBeforeRendering: function (oEvent) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            var oModel          = this.getView().getModel();                                                                                                                                                                                                   
            var oBindingContext = this.getView().getParent().getBindingContext();                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            oModel.read(oBindingContext.sPath, {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                success: function (oData) {                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    // Ativa botão 'XML' somente para documentos CT-e e NF-e, menos pro NFS-e                                                                                                                                                                  
                    if (oData.tipo == 'CT-e' || oData.tipo == 'NF-e') {                                                                                                                                                                                        
                        this.byId("br.com.trescoracoes.monitorgko::sap.suite.ui.generic.template.ObjectPage.view.Details::ZC_TM_MONITOR_GKO--action::onActionXMLButton").setVisible(true)                                                                      
                    } else {                                                                                                                                                                                                                                   
                        this.byId("br.com.trescoracoes.monitorgko::sap.suite.ui.generic.template.ObjectPage.view.Details::ZC_TM_MONITOR_GKO--action::onActionXMLButton").setVisible(false)                                                                     
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                }.bind(this),                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                error: function (oError) {                                                                                                                                                                                                                     
                }.bind(this)                                                                                                                                                                                                                                   
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onAfterRendering: function (oEvent) {                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onActionPDF: function(oEvent) {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            var vObject = this.getView().getParent().getBindingContext().getObject();                                                                                                                                                                          
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            if ( vObject.c0_chcte ) {                                                                                                                                                                                                                          
                var vDoctype = '2'; // PDF CTE                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
            else if ( vObject.n0_chnfse ) {                                                                                                                                                                                                                    
                var vDoctype = '1'; // PDF NFE                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
            else {                                                                                                                                                                                                                                             
                alert("Documento com tipo não definido");                                                                                                                                                                                                      
                return;                                                                                                                                                                                                                                        
            }                                                                                                                                                                                                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            var oServiceUrl = "/sap/opu/odata/SAP/ZTM_DOWNLOAD_GESTAO_FRETE_SRV/";                                                                                                                                                                             
            var oSource = oServiceUrl + "downloadSet(Acckey='" + vObject.acckey + "',Doctype='" + vDoctype + "',Auto='')/$value";                                                                                                                              
            var oPDFViewer = new PDFViewer();                                                                                                                                                                                                                  
            this.getView().addDependent(oPDFViewer);                                                                                                                                                                                                           
            oPDFViewer.setSource(oSource);                                                                                                                                                                                                                     
            oPDFViewer.open();                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onActionXML: function(oEvent) {                                                                                                                                                                                                                        
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            var vObject = this.getView().getParent().getBindingContext().getObject();                                                                                                                                                                          
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            if ( vObject.tipo == 'CT-e') {                                                                                                                                                                                                                     
                var vDoctype = '5'; // XML CTE                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
            else if ( vObject.tipo == 'NF-e') {                                                                                                                                                                                                                
                var vDoctype = '4'; // XML NFE                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
            else {                                                                                                                                                                                                                                             
                alert("Opção não disponível para este tipo de documento");                                                                                                                                                                                     
                return;&nbsp;                                                                                                                                                                                                                                  
            }                                                                                                                                                                                                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            var oServiceUrl = "/sap/opu/odata/SAP/ZTM_DOWNLOAD_GESTAO_FRETE_SRV/";                                                                                                                                                                             
            var oSource = oServiceUrl + "downloadSet(Acckey='" + vObject.acckey + "',Doctype='" + vDoctype + "',Auto='')/$value";                                                                                                                              
            var oPDFViewer = new PDFViewer();                                                                                                                                                                                                                  
            this.getView().addDependent(oPDFViewer);                                                                                                                                                                                                           
            oPDFViewer.setSource(oSource);                                                                                                                                                                                                                     
            oPDFViewer.downloadPDF();                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        showSuccessMessage: function (sMessage) {                                                                                                                                                                                                              
            this.getView().setBusy(false);                                                                                                                                                                                                                     
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        showErrorMessage: function (sMessage) {                                                                                                                                                                                                                
            this.getView().setBusy(false);                                                                                                                                                                                                                     
        }                                                                                                                                                                                                                                                      
    };&nbsp;&nbsp;                                                                                                                                                                                                                                             
});                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               