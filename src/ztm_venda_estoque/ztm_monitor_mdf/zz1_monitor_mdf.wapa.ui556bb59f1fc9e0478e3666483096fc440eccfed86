sap.ui.define(                                                                                                                                                                                                                                                 
    [                                                                                                                                                                                                                                                          
        "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                         
        "sap/m/MessageToast",                                                                                                                                                                                                                                  
        "sap/m/MessageBox"                                                                                                                                                                                                                                     
    ],                                                                                                                                                                                                                                                         
    function (JSONModel, MessageToast, MessageBox) {                                                                                                                                                                                                           
        "use strict";                                                                                                                                                                                                                                          
        return {                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            onInit: function (oEvent) {                                                                                                                                                                                                                        
                debugger;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                /*                                                                                                                                                                                                                                             
                var oViewModel = new JSONModel({                                                                                                                                                                                                               
                   editing: false                                                                                                                                                                                                                              
                 });                                                                                                                                                                                                                                           
                this.getOwnerComponent().setModel(oViewModel, "detailView")                                                                                                                                                                                    
&nbsp;                                                                                                                                                                                                                                                         
                var oRouter = sap.ui.core.UIComponent.getRouterFor(this);                                                                                                                                                                                      
                oRouter.getRoute("MDFObjectPage").attachPatternMatched(this._onObjectMatched, this);                                                                                                                                                           
                oRouter.getRoute("MDFObjectPage").attachBeforeMatched(this.reset, this);                                                                                                                                                                       
                */                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                this.getOwnerComponent().getModel().resetChanges();                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            _onObjectMatched: function (oEvent) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                debugger;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                var oModel = this.getView().getModel();                                                                                                                                                                                                        
                var oBindingContext = this.getView().getParent().getBindingContext();                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                detailForm.bindElement({                                                                                                                                                                                                                       
                    path: oBindingContext.sPath,                                                                                                                                                                                                               
                    parameters: {                                                                                                                                                                                                                              
                        $$updateGroupId: batchGroupId                                                                                                                                                                                                          
                    },                                                                                                                                                                                                                                         
                    events: {                                                                                                                                                                                                                                  
                        dataRequested: () => this.byId("dynamicPageId").setBusy(true),                                                                                                                                                                         
                        dataReceived: () => this.byId("dynamicPageId").setBusy(false),                                                                                                                                                                         
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                dynamicPage = this.getView().byId("dynamicPageId");                                                                                                                                                                                            
                dynamicPage.bindElement({ path: oBindingContext.sPath });                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            reset: function (oEvent) {                                                                                                                                                                                                                         
                this.getOwnerComponent().getModel().resetChanges();                                                                                                                                                                                            
                this.resetEditingStatus();                                                                                                                                                                                                                     
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            resetEditingStatus: function () {                                                                                                                                                                                                                  
                const oViewModel = this.getOwnerComponent().getModel("detailView");                                                                                                                                                                            
                oViewModel.setProperty("/editing", false, null, true);                                                                                                                                                                                         
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onExit: function (oEvent) {                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onBeforeRendering: function (oEvent) {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                var oModel = this.getView().getModel();                                                                                                                                                                                                        
                var oBindingContext = this.getView().getParent().getBindingContext();                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                oModel.read(oBindingContext.sPath, {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    success: function (oData) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        // Verifica se processo foi criado à partir de uma OF. Neste caso, bloquear os botões                                                                                                                                                  
                        if (oData.RefOf) {                                                                                                                                                                                                                     
                            this.byId("br.com.trescoracoes.monitormdf::sap.suite.ui.generic.template.ObjectPage.view.Details::MDF--action::onActionNotaFiscalButton").setVisible(false)                                                                        
                            this.byId("br.com.trescoracoes.monitormdf::sap.suite.ui.generic.template.ObjectPage.view.Details::MDF--action::onActionOrdemFreteButton").setVisible(false)                                                                        
                        } else {                                                                                                                                                                                                                               
                            this.byId("br.com.trescoracoes.monitormdf::sap.suite.ui.generic.template.ObjectPage.view.Details::MDF--action::onActionNotaFiscalButton").setVisible(true)                                                                         
                            this.byId("br.com.trescoracoes.monitormdf::sap.suite.ui.generic.template.ObjectPage.view.Details::MDF--action::onActionOrdemFreteButton").setVisible(true)                                                                         
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }.bind(this),                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    error: function (oError) {                                                                                                                                                                                                                 
                        //this.byId("br.com.trescoracoes.monitormdf::sap.suite.ui.generic.template.ObjectPage.view.Details::MDF--action::onActionNotaFiscalButton").setVisible(true)                                                                           
                        //this.byId("br.com.trescoracoes.monitormdf::sap.suite.ui.generic.template.ObjectPage.view.Details::MDF--action::onActionOrdemFreteButton").setVisible(true)                                                                           
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onAfterRendering: function (oEvent) {                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionNotaFiscal: function (oEvent) {                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                var Object = oEvent.getSource().getBindingContext().getObject();                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                if (!Object.Guid) {                                                                                                                                                                                                                            
                    alert('Opção disponível após salvar o documento');                                                                                                                                                                                         
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Prepara conteúdo do pop-up                                                                                                                                                                                                                     
                =================================================================== */                                                                                                                                                                         
                var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                              
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Text({ text: ' ' }),                                                                                                                                                                                                         
                        new sap.m.Label({ text: "Adicionar Notas Fiscais na aba 'Notas Transportadas':" }),                                                                                                                                                    
                        new sap.m.MultiInput('inNotaFiscal', {                                                                                                                                                                                                 
                            showValueHelp: false                                                                                                                                                                                                               
                        })                                                                                                                                                                                                                                     
                    ]                                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Prepara pop-up                                                                                                                                                                                                                                 
                =================================================================== */                                                                                                                                                                         
                var pressDialog = new sap.m.Dialog({                                                                                                                                                                                                           
                    type: 'Message',                                                                                                                                                                                                                           
                    title: "[+] Chave de Acesso",                                                                                                                                                                                                              
                    resizable: true,                                                                                                                                                                                                                           
                    draggable: true,                                                                                                                                                                                                                           
                    titleAlignment: sap.m.TitleAlignment.Center,                                                                                                                                                                                               
                    content: oContent,                                                                                                                                                                                                                         
                    beginButton: new sap.m.Button({                                                                                                                                                                                                            
                        type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                     
                        text: "[+] Chave de Acesso",                                                                                                                                                                                                           
                        press: function () {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            // Get array of Tokens&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                       
                            var aTokens = sap.ui.getCore().byId('inNotaFiscal').getTokens();                                                                                                                                                                   
                            // Get an array of the keys of the tokens and join them together with a ";" inbetween                                                                                                                                              
                            var NotaFiscal = aTokens.map(function (oToken) { return oToken.getKey(); }).join(";");                                                                                                                                             
                                                                                                                                                                                                                                                               
                            pressDialog.close();                                                                                                                                                                                                               
                            that.onEventAddNotaFiscal(that, Object, NotaFiscal);                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    endButton: new sap.m.Button({                                                                                                                                                                                                              
                        text: "Cancelar",                                                                                                                                                                                                                      
                        press: function () {                                                                                                                                                                                                                   
                            pressDialog.close();                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    afterClose: function () {                                                                                                                                                                                                                  
                        pressDialog.destroy();                                                                                                                                                                                                                 
                    },                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                pressDialog.open();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oMultiInput = sap.ui.getCore().byId("inNotaFiscal");                                                                                                                                                                                       
                var fnValidator = function (args) {                                                                                                                                                                                                            
                    var text = args.text;                                                                                                                                                                                                                      
                    return new sap.m.Token({ key: text, text: text });                                                                                                                                                                                         
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                oMultiInput.addValidator(fnValidator);                                                                                                                                                                                                         
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onEventAddNotaFiscal: function (that, Object, AccessKey) {                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupa referência à tabela do relatório                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                var entitySet = "monitorAdicionarNFSet(Id='" + Object.Guid + "',AccessKey='" + AccessKey + "')";                                                                                                                                               
                var vServiceUrl = "/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";                                                                                                                                                                                   
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Entra no Gateway&nbsp;                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oModel.read(entitySet, {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                showSuccessMessage();                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                that.oView.getController().extensionAPI.refresh();                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                             
                                    message: oResponse.data.Message,                                                                                                                                                                                           
                                    persistent: true, // create message as transition message                                                                                                                                                                  
                                    type: sap.ui.core.MessageType.Success                                                                                                                                                                                      
                                }));                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                showErrorMessage();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                that.oView.getController().extensionAPI.refresh();                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                // Recupera texto da mensagem                                                                                                                                                                                                  
                                let aMessage = [];                                                                                                                                                                                                             
                                for (const res of oError.response.body.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                         
                                    aMessage.push(res[1]);                                                                                                                                                                                                     
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                // Recupera o tipo da mensagem                                                                                                                                                                                                 
                                let aSeverity = [];                                                                                                                                                                                                            
                                for (const res of oError.response.body.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)) {                                                                                                                                       
                                    switch (res[1]) {                                                                                                                                                                                                          
                                        case "error":                                                                                                                                                                                                          
                                            aSeverity.push(sap.ui.core.MessageType.Error);                                                                                                                                                                     
                                            break;                                                                                                                                                                                                             
                                        case "info":                                                                                                                                                                                                           
                                            aSeverity.push(sap.ui.core.MessageType.Information);                                                                                                                                                               
                                            break;                                                                                                                                                                                                             
                                        case "success":                                                                                                                                                                                                        
                                            aSeverity.push(sap.ui.core.MessageType.Success);                                                                                                                                                                   
                                            break;                                                                                                                                                                                                             
                                        case "warning":                                                                                                                                                                                                        
                                            aSeverity.push(sap.ui.core.MessageType.Warning);                                                                                                                                                                   
                                            break;                                                                                                                                                                                                             
                                        default:                                                                                                                                                                                                               
                                            aSeverity.push(sap.ui.core.MessageType.None);                                                                                                                                                                      
                                            break;                                                                                                                                                                                                             
                                    }                                                                                                                                                                                                                          
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                // Exibe mensagem                                                                                                                                                                                                              
                                for (let i = 0; i < aMessage.length; i++) {                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                    if (aMessage[i] == "Ocorreu uma exceção") {                                                                                                                                                                                
                                        continue;                                                                                                                                                                                                              
                                    }                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                         
                                        message: aMessage[i],                                                                                                                                                                                                  
                                        persistent: true, // create message as transition message                                                                                                                                                              
                                        type: aSeverity[i]                                                                                                                                                                                                     
                                    }));                                                                                                                                                                                                                       
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura pop-up de mensagens                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                this.extensionAPI.securedExecution(fnFunction,                                                                                                                                                                                                 
                    {                                                                                                                                                                                                                                          
                        busy: {                                                                                                                                                                                                                                
                            set: true,                                                                                                                                                                                                                         
                            check: false                                                                                                                                                                                                                       
                        },                                                                                                                                                                                                                                     
                        sActionLabel: "Mensagens"                                                                                                                                                                                                              
                    });                                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showSuccessMessage: function (sMessage) {                                                                                                                                                                                                          
                this.getView().setBusy(false);                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showErrorMessage: function (sMessage) {                                                                                                                                                                                                            
                this.getView().setBusy(false);                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionOrdemFrete: function (oEvent) {                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                var Object = oEvent.getSource().getBindingContext().getObject();                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                if (!Object.Guid) {                                                                                                                                                                                                                            
                    alert('Opção disponível após salvar o documento');                                                                                                                                                                                         
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Prepara conteúdo do pop-up                                                                                                                                                                                                                     
                =================================================================== */                                                                                                                                                                         
                var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                              
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Text({ text: ' ' }),                                                                                                                                                                                                         
                        new sap.m.Label({ text: "Adicionar Ordens de Frete na aba 'Notas Transportadas':" }),                                                                                                                                                  
                        new sap.m.MultiInput('inOrdemFrete', {                                                                                                                                                                                                 
                            showValueHelp: false,                                                                                                                                                                                                              
                        })                                                                                                                                                                                                                                     
                    ]                                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Prepara pop-up                                                                                                                                                                                                                                 
                =================================================================== */                                                                                                                                                                         
                var pressDialog = new sap.m.Dialog({                                                                                                                                                                                                           
                    type: 'Message',                                                                                                                                                                                                                           
                    title: "[+] Ordem Frete",                                                                                                                                                                                                                  
                    resizable: true,                                                                                                                                                                                                                           
                    draggable: true,                                                                                                                                                                                                                           
                    titleAlignment: sap.m.TitleAlignment.Center,                                                                                                                                                                                               
                    content: oContent,                                                                                                                                                                                                                         
                    beginButton: new sap.m.Button({                                                                                                                                                                                                            
                        type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                     
                        text: "[+] Ordem Frete",                                                                                                                                                                                                               
                        press: function () {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            // Get array of Tokens&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                       
                            var aTokens = sap.ui.getCore().byId('inOrdemFrete').getTokens();                                                                                                                                                                   
                            // Get an array of the keys of the tokens and join them together with a ";" inbetween                                                                                                                                              
                            var OrdemFrete = aTokens.map(function (oToken) { return oToken.getKey(); }).join(";");                                                                                                                                             
                                                                                                                                                                                                                                                               
                            pressDialog.close();                                                                                                                                                                                                               
                            that.onEventAddOrdemFrete(that, Object, OrdemFrete);                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    endButton: new sap.m.Button({                                                                                                                                                                                                              
                        text: "Cancelar",                                                                                                                                                                                                                      
                        press: function () {                                                                                                                                                                                                                   
                            pressDialog.close();                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    afterClose: function () {                                                                                                                                                                                                                  
                        pressDialog.destroy();                                                                                                                                                                                                                 
                    },                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                pressDialog.open();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oMultiInput = sap.ui.getCore().byId("inOrdemFrete");                                                                                                                                                                                       
                var fnValidator = function (args) {                                                                                                                                                                                                            
                    var text = args.text;                                                                                                                                                                                                                      
                    return new sap.m.Token({ key: text, text: text });                                                                                                                                                                                         
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                oMultiInput.addValidator(fnValidator);                                                                                                                                                                                                         
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onEventAddOrdemFrete: function (that, Object, OrdemFrete) {                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupa referência à tabela do relatório                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                var entitySet = "monitorAdicionarOFSet(Id='" + Object.Guid + "',OrdemFrete='" + OrdemFrete + "')";                                                                                                                                             
                var vServiceUrl = "/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";                                                                                                                                                                                   
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Entra no Gateway&nbsp;                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oModel.read(entitySet, {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                showSuccessMessage();                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                that.oView.getController().extensionAPI.refresh();                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                             
                                    message: oResponse.data.Message,                                                                                                                                                                                           
                                    persistent: true, // create message as transition message                                                                                                                                                                  
                                    type: sap.ui.core.MessageType.Success                                                                                                                                                                                      
                                }));                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                showErrorMessage();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                that.oView.getController().extensionAPI.refresh();                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                // Recupera texto da mensagem                                                                                                                                                                                                  
                                let aMessage = [];                                                                                                                                                                                                             
                                for (const res of oError.response.body.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                         
                                    aMessage.push(res[1]);                                                                                                                                                                                                     
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                // Recupera o tipo da mensagem                                                                                                                                                                                                 
                                let aSeverity = [];                                                                                                                                                                                                            
                                for (const res of oError.response.body.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)) {                                                                                                                                       
                                    switch (res[1]) {                                                                                                                                                                                                          
                                        case "error":                                                                                                                                                                                                          
                                            aSeverity.push(sap.ui.core.MessageType.Error);                                                                                                                                                                     
                                            break;                                                                                                                                                                                                             
                                        case "info":                                                                                                                                                                                                           
                                            aSeverity.push(sap.ui.core.MessageType.Information);                                                                                                                                                               
                                            break;                                                                                                                                                                                                             
                                        case "success":                                                                                                                                                                                                        
                                            aSeverity.push(sap.ui.core.MessageType.Success);                                                                                                                                                                   
                                            break;                                                                                                                                                                                                             
                                        case "warning":                                                                                                                                                                                                        
                                            aSeverity.push(sap.ui.core.MessageType.Warning);                                                                                                                                                                   
                                            break;                                                                                                                                                                                                             
                                        default:                                                                                                                                                                                                               
                                            aSeverity.push(sap.ui.core.MessageType.None);                                                                                                                                                                      
                                            break;                                                                                                                                                                                                             
                                    }                                                                                                                                                                                                                          
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                // Exibe mensagem                                                                                                                                                                                                              
                                for (let i = 0; i < aMessage.length; i++) {                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                    if (aMessage[i] == "Ocorreu uma exceção") {                                                                                                                                                                                
                                        continue;                                                                                                                                                                                                              
                                    }                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                         
                                        message: aMessage[i],                                                                                                                                                                                                  
                                        persistent: true, // create message as transition message                                                                                                                                                              
                                        type: aSeverity[i]                                                                                                                                                                                                     
                                    }));                                                                                                                                                                                                                       
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura pop-up de mensagens                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                this.extensionAPI.securedExecution(fnFunction,                                                                                                                                                                                                 
                    {                                                                                                                                                                                                                                          
                        busy: {                                                                                                                                                                                                                                
                            set: true,                                                                                                                                                                                                                         
                            check: false                                                                                                                                                                                                                       
                        },                                                                                                                                                                                                                                     
                        sActionLabel: "Mensagens"                                                                                                                                                                                                              
                    });                                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionPrint: function (oEvent) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupera linha primeira linha selecionada                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                let oItems = oEvent.getSource().getBindingContext();                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama PDF Viewer com o link da URL                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var sServiceURL = "/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                if (oItems.getObject().StatusCode == '100') {                                                                                                                                                                                                  
                    var vId = oItems.getObject().Guid.toString().replaceAll("-", "").toUpperCase() + ';';                                                                                                                                                      
                } else {                                                                                                                                                                                                                                       
                    var vId = '';                                                                                                                                                                                                                              
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (!vId) {                                                                                                                                                                                                                                    
                    alert("Somente é possivel imprimir MDF-e autorizada.");                                                                                                                                                                                    
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var sSource = sServiceURL + "downloadSet(Id='" + vId + "')/$value";                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var opdfViewer = new sap.m.PDFViewer();                                                                                                                                                                                                        
                this.getView().addDependent(opdfViewer);                                                                                                                                                                                                       
                opdfViewer.setSource(sSource);                                                                                                                                                                                                                 
                opdfViewer.setTitle("Fomulário");                                                                                                                                                                                                              
                opdfViewer.open();                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               