sap.ui.define(                                                                                                                                                                                                                                                 
    [                                                                                                                                                                                                                                                          
    ],                                                                                                                                                                                                                                                         
    function () {                                                                                                                                                                                                                                              
        "use strict";                                                                                                                                                                                                                                          
        return {                                                                                                                                                                                                                                               
            parseXmlToJson: function (xml) {                                                                                                                                                                                                                   
                const json = {};                                                                                                                                                                                                                               
                for (const res of xml.matchAll(/(?:<(\w*)(?:\s[^>]*)*>)((?:(?!<\1).)*)(?:<\/\1>)|<(\w*)(?:\s*)*\/>/gm)) {                                                                                                                                      
                    const key = res[1] || res[3];                                                                                                                                                                                                              
                    const value = res[2] && this.parseXmlToJson(res[2]);                                                                                                                                                                                       
                    json[key] = ((value && Object.keys(value).length) ? value : res[2]) || null;                                                                                                                                                               
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                return json;                                                                                                                                                                                                                                   
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showSuccessMessage: function (sMessage) {                                                                                                                                                                                                          
                this.getView().setBusy(false);                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showErrorMessage: function (sMessage) {                                                                                                                                                                                                            
                this.getView().setBusy(false);                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
            onAgrupar: function (oEvent) {                                                                                                                                                                                                                     
                var that = this;                                                                                                                                                                                                                               
                let oSource = oEvent.getSource();                                                                                                                                                                                                              
                const sEntityKey1 = 'BR_NotaFiscal';                                                                                                                                                                                                           
                const sEntityKey2 = 'OrdemFrete';                                                                                                                                                                                                              
                const vServiceUrl = "/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV";                                                                                                                                                                                  
                const sBindingPath = "/CockpitMDFSet";                                                                                                                                                                                                         
                let oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupa referência à tabela do relatório                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                let items = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                                
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Preenche filtro de acordo com linhas selecionadas                                                                                                                                                                                              
                =================================================================== */                                                                                                                                                                         
                let aFilters = [];                                                                                                                                                                                                                             
                for (let z = 0; z < items.length; z++) {                                                                                                                                                                                                       
                    let item3 = items[z].getObject();                                                                                                                                                                                                          
                    let oFilter = new sap.ui.model.Filter({                                                                                                                                                                                                    
                        filters: [                                                                                                                                                                                                                             
                            new sap.ui.model.Filter(sEntityKey1, sap.ui.model.FilterOperator.EQ, item3.BR_NotaFiscal),                                                                                                                                         
                            new sap.ui.model.Filter(sEntityKey2, sap.ui.model.FilterOperator.EQ, item3.OrdemFrete)                                                                                                                                             
                        ],                                                                                                                                                                                                                                     
                        and: true                                                                                                                                                                                                                              
                    })                                                                                                                                                                                                                                         
                    aFilters.push(oFilter);                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Entra no Gateway&nbsp;                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                        oModel.read(sBindingPath, {                                                                                                                                                                                                            
                            filters: [new sap.ui.model.Filter(aFilters, false)],                                                                                                                                                                               
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                   
                                const hdrMessage = oResponse.headers["sap-message"];                                                                                                                                                                           
                                const hdrMessageObject = JSON.parse(JSON.stringify(hdrMessage))                                                                                                                                                                
                                const json = this.parseXmlToJson(hdrMessageObject)                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                             
                                    message: json.notification.message,                                                                                                                                                                                        
                                    // message: JSON.parse(JSON.stringify(oResponse.data.results)),                                                                                                                                                            
                                    persistent: true, // create message as transition message                                                                                                                                                                  
                                    type: sap.ui.core.MessageType.Success                                                                                                                                                                                      
                                })); showSuccessMessage();                                                                                                                                                                                                     
                            }.bind(this),                                                                                                                                                                                                                      
                            error: function (oError) {                                                                                                                                                                                                         
                                showErrorMessage();                                                                                                                                                                                                            
                                let result = [];                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                for (const res of oError.response.body.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                         
                                    result.push(res[1]);                                                                                                                                                                                                       
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                for (let i = 0; i < result.length; i++) {                                                                                                                                                                                      
                                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                         
                                        message: result[i],                                                                                                                                                                                                    
                                        persistent: true, // create message as transition message                                                                                                                                                              
                                        type: sap.ui.core.MessageType.Error                                                                                                                                                                                    
                                    }));                                                                                                                                                                                                                       
                                }                                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                    }.bind(this))                                                                                                                                                                                                                              
                }.bind(this)                                                                                                                                                                                                                                   
                this.extensionAPI.securedExecution(fnFunction,                                                                                                                                                                                                 
                    {                                                                                                                                                                                                                                          
                        busy: {                                                                                                                                                                                                                                
                            set: true,                                                                                                                                                                                                                         
                            check: false                                                                                                                                                                                                                       
                        },                                                                                                                                                                                                                                     
                        sActionLabel: oSource.getText()                                                                                                                                                                                                        
                    });                                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onDesagrupar: function (oEvent) {                                                                                                                                                                                                                  
                var that = this;                                                                                                                                                                                                                               
                let oSource = oEvent.getSource();                                                                                                                                                                                                              
                const sEntityKey1 = 'BR_NotaFiscal';                                                                                                                                                                                                           
                const sEntityKey2 = 'OrdemFrete';                                                                                                                                                                                                              
                const vServiceUrl = "/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV";                                                                                                                                                                                  
                const sBindingPath = "/DesagruparMDFSet";                                                                                                                                                                                                      
                let oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupa referência à tabela do relatório                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                let items = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                                
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Preenche filtro de acordo com linhas selecionadas                                                                                                                                                                                              
                =================================================================== */                                                                                                                                                                         
                let aFilters = [];                                                                                                                                                                                                                             
                for (let z = 0; z < items.length; z++) {                                                                                                                                                                                                       
                    let item3 = items[z].getObject();                                                                                                                                                                                                          
                    let oFilter = new sap.ui.model.Filter({                                                                                                                                                                                                    
                        filters: [                                                                                                                                                                                                                             
                            new sap.ui.model.Filter(sEntityKey1, sap.ui.model.FilterOperator.EQ, item3.BR_NotaFiscal),                                                                                                                                         
                            new sap.ui.model.Filter(sEntityKey2, sap.ui.model.FilterOperator.EQ, item3.OrdemFrete)                                                                                                                                             
                        ],                                                                                                                                                                                                                                     
                        and: true                                                                                                                                                                                                                              
                    })                                                                                                                                                                                                                                         
                    aFilters.push(oFilter);                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Entra no Gateway&nbsp;                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                        oModel.read(sBindingPath, {                                                                                                                                                                                                            
                            filters: [new sap.ui.model.Filter(aFilters, false)],                                                                                                                                                                               
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                   
                                const hdrMessage = oResponse.headers["sap-message"];                                                                                                                                                                           
                                const hdrMessageObject = JSON.parse(JSON.stringify(hdrMessage))                                                                                                                                                                
                                const json = this.parseXmlToJson(hdrMessageObject)                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                             
                                    message: json.notification.message,                                                                                                                                                                                        
                                    // message: JSON.parse(JSON.stringify(oResponse.data.results)),                                                                                                                                                            
                                    persistent: true, // create message as transition message                                                                                                                                                                  
                                    type: sap.ui.core.MessageType.Success                                                                                                                                                                                      
                                })); showSuccessMessage();                                                                                                                                                                                                     
                            }.bind(this),                                                                                                                                                                                                                      
                            error: function (oError) {                                                                                                                                                                                                         
                                showErrorMessage();                                                                                                                                                                                                            
                                let result = [];                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                for (const res of oError.response.body.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                         
                                    result.push(res[1]);                                                                                                                                                                                                       
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                for (let i = 0; i < result.length; i++) {                                                                                                                                                                                      
                                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                         
                                        message: result[i],                                                                                                                                                                                                    
                                        persistent: true, // create message as transition message                                                                                                                                                              
                                        type: sap.ui.core.MessageType.Error                                                                                                                                                                                    
                                    }));                                                                                                                                                                                                                       
                                }                                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                    }.bind(this))                                                                                                                                                                                                                              
                }.bind(this)                                                                                                                                                                                                                                   
                this.extensionAPI.securedExecution(fnFunction,                                                                                                                                                                                                 
                    {                                                                                                                                                                                                                                          
                        busy: {                                                                                                                                                                                                                                
                            set: true,                                                                                                                                                                                                                         
                            check: false                                                                                                                                                                                                                       
                        },                                                                                                                                                                                                                                     
                        sActionLabel: oSource.getText()                                                                                                                                                                                                        
                    });                                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionNavigateMDFe: function (oEvent) {                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Verifica se usuário tem permissão para navegação&nbsp;                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                          
                    { target: { shellHash: "ZZ1_MONITOR_MDF-manage" } }                                                                                                                                                                                        
                ])                                                                                                                                                                                                                                             
                    .done(function (aResponse) {                                                                                                                                                                                                               
                        aResponse.map(function (elem, index) {                                                                                                                                                                                                 
                            if (elem.supported === true) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                /* ===================================================================&nbsp;                                                                                                                                                   
                                Chama outro aplicativo                                                                                                                                                                                                         
                                =================================================================== */                                                                                                                                                         
                                var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                                   
                                    sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                            
                                        target: { semanticObject: "ZZ1_MONITOR_MDF", action: "manage" }                                                                                                                                                        
                                    }));                                                                                                                                                                                                                       
                                sap.m.URLHelper.redirect(href_parameters, false);                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                            else {                                                                                                                                                                                                                             
                                alert('Usuário sem permissão para acessar o link');                                                                                                                                                                            
                            }                                                                                                                                                                                                                                  
                        })                                                                                                                                                                                                                                     
                    })                                                                                                                                                                                                                                         
                    .fail(function () {                                                                                                                                                                                                                        
                        alert('Falha ao acessar o link');                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionPrint: function (oEvent) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupera linha primeira linha selecionada                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama PDF Viewer com o link da URL                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var sServiceURL = "/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                var vId = oItems.reduce(function (sId, oItems) {                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    if (oItems.getObject().StatusCode == '100') {                                                                                                                                                                                              
                        return sId + oItems.getObject().Guid.toString().replaceAll("-", "").toUpperCase() + ';';                                                                                                                                               
                    } else {                                                                                                                                                                                                                                   
                        return sId;                                                                                                                                                                                                                            
                    }                                                                                                                                                                                                                                          
                }, '');                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                if (!vId) {                                                                                                                                                                                                                                    
                    alert("Nenhuma MDF-e autorizada foi selecionada");                                                                                                                                                                                         
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var sSource = sServiceURL + "downloadSet(Id='" + vId + "')/$value";                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var opdfViewer = new sap.m.PDFViewer();                                                                                                                                                                                                        
                this.getView().addDependent(opdfViewer);                                                                                                                                                                                                       
                opdfViewer.setSource(sSource);                                                                                                                                                                                                                 
                opdfViewer.setTitle("Fomulário");                                                                                                                                                                                                              
                opdfViewer.open();                                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionCreateMdfUsingFo: function (oEvent) {                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                var entitySet = "usarOfCriarMdfeListaSet(OrdemFrete='')";                                                                                                                                                                                      
                var vServiceUrl = "/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";                                                                                                                                                                                   
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Gateway para processar logs                                                                                                                                                                                                              
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oModel.read(entitySet, {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                showSuccessMessage();                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                var oList = oData.OrdemFreteLista.split(";");                                                                                                                                                                                  
                                let oListFO = [];                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                for (let i = 0; i < oList.length; i++) {                                                                                                                                                                                       
                                    oListFO.push({ FreightOrder: oList[i] });                                                                                                                                                                                  
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                this.generateFileSearchHelp(oListFO);                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                showErrorMessage();                                                                                                                                                                                                            
                                this.showLog(oError.response.body);                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                var mParameters = {                                                                                                                                                                                                                            
                    //sActionLabel: this.getView().getModel().getProperty("/#EmissaoType/UseAvailableCheckBox/@sap:label"),                                                                                                                                    
                    dataloss: false                                                                                                                                                                                                                            
                };                                                                                                                                                                                                                                             
                this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                   
            },                                                                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            generateFileSearchHelp: function (Results) {                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura lista Dropdown                                                                                                                                                                                                                       
                =================================================================== */                                                                                                                                                                         
                var oComboBox = new sap.m.ComboBox({                                                                                                                                                                                                           
                    id: 'oComboBox',                                                                                                                                                                                                                           
                    items: {                                                                                                                                                                                                                                   
                        path: '/items',                                                                                                                                                                                                                        
                        //Configura nome das colunas                                                                                                                                                                                                           
                        template: new sap.ui.core.ListItem({                                                                                                                                                                                                   
                            key: "{FreightOrder}",                                                                                                                                                                                                             
                            text: "{FreightOrder}",                                                                                                                                                                                                            
                            //additionalText: "{Status}"                                                                                                                                                                                                       
                        }),                                                                                                                                                                                                                                    
                        templateShareable: false                                                                                                                                                                                                               
                    },                                                                                                                                                                                                                                         
                    showSecondaryValues: true                                                                                                                                                                                                                  
                })                                                                                                                                                                                                                                             
                // Adiciona tabela como lista                                                                                                                                                                                                                  
                oComboBox.setModel(new sap.ui.model.json.JSONModel({ items: Results }));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura conteúdo do Pop-up                                                                                                                                                                                                                   
                =================================================================== */                                                                                                                                                                         
                var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                              
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Text({ text: "Favor informar a Ordem de Frete utilizada para gerar um novo MDFe." }),                                                                                                                                        
                        new sap.m.Text({ text: ' ' }),                                                                                                                                                                                                         
                        oComboBox                                                                                                                                                                                                                              
                    ]                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura botão de impressão                                                                                                                                                                                                                   
                =================================================================== */                                                                                                                                                                         
                var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                        
                    type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                         
                    text: "Criar MDFe usando OF",                                                                                                                                                                                                              
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        // var ordemFrete = sap.ui.getCore().byId('oComboBox').getSelectedKey();                                                                                                                                                               
                        var ordemFrete = sap.ui.getCore().byId('oComboBox').getValue();                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        if (!ordemFrete) {                                                                                                                                                                                                                     
                            alert("Informar Ordem de Frete antes de prosseguir");                                                                                                                                                                              
                        }                                                                                                                                                                                                                                      
                        else {                                                                                                                                                                                                                                 
                            pressDialog.close();                                                                                                                                                                                                               
                            that.generateFile(ordemFrete);                                                                                                                                                                                                     
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botão de cancelar                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var oCancelButton = new sap.m.Button({                                                                                                                                                                                                         
                    text: 'Cancelar',                                                                                                                                                                                                                          
                    type: 'Reject',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                        pressDialog.close();                                                                                                                                                                                                                   
                        pressDialog.destroy();                                                                                                                                                                                                                 
                        this.getView().removeAllDependents();                                                                                                                                                                                                  
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria janela pop-up                                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var pressDialog = new sap.m.Dialog({                                                                                                                                                                                                           
                    type: 'Message',                                                                                                                                                                                                                           
                    title: "Criar MDFe usando OF",                                                                                                                                                                                                             
                    resizable: true,                                                                                                                                                                                                                           
                    draggable: true,                                                                                                                                                                                                                           
                    titleAlignment: sap.m.TitleAlignment.Center,                                                                                                                                                                                               
                    content: oContent,                                                                                                                                                                                                                         
                    beginButton: oTriggerButton,                                                                                                                                                                                                               
                    endButton: oCancelButton,                                                                                                                                                                                                                  
                    afterClose: function () {                                                                                                                                                                                                                  
                        pressDialog.destroy();                                                                                                                                                                                                                 
                    },                                                                                                                                                                                                                                         
                    contentWidth: "20%",                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama janela pop-up                                                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                pressDialog.open();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            generateFile: function (ordemFrete) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var entitySet = "usarOfCriarMdfeSet(OrdemFrete='" + ordemFrete + "')";                                                                                                                                                                         
                var vServiceUrl = "/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";                                                                                                                                                                                   
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Gateway para processar logs                                                                                                                                                                                                              
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oModel.read(entitySet, {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                showSuccessMessage();                                                                                                                                                                                                          
                                sap.m.MessageToast.show(oData.Message);                                                                                                                                                                                        
                                this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                showErrorMessage();                                                                                                                                                                                                            
                                this.showLog(oError.response.body);                                                                                                                                                                                            
                                this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                var mParameters = {                                                                                                                                                                                                                            
                    //sActionLabel: this.getView().getModel().getProperty("/#EmissaoType/UseAvailableCheckBox/@sap:label"),                                                                                                                                    
                    dataloss: false                                                                                                                                                                                                                            
                };                                                                                                                                                                                                                                             
                this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showLog: function (sMessage) {                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                // Recupera texto da mensagem                                                                                                                                                                                                                  
                let aMessage = [];                                                                                                                                                                                                                             
                for (const res of sMessage.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                                                     
                    aMessage.push(res[1]);                                                                                                                                                                                                                     
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // Recupera o tipo da mensagem                                                                                                                                                                                                                 
                let aSeverity = [];                                                                                                                                                                                                                            
                for (const res of sMessage.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)) {                                                                                                                                                                   
                    switch (res[1]) {                                                                                                                                                                                                                          
                        case "error":                                                                                                                                                                                                                          
                            aSeverity.push(sap.ui.core.MessageType.Error);                                                                                                                                                                                     
                            break;                                                                                                                                                                                                                             
                        case "info":                                                                                                                                                                                                                           
                            aSeverity.push(sap.ui.core.MessageType.Information);                                                                                                                                                                               
                            break;                                                                                                                                                                                                                             
                        case "success":                                                                                                                                                                                                                        
                            aSeverity.push(sap.ui.core.MessageType.Success);                                                                                                                                                                                   
                            break;                                                                                                                                                                                                                             
                        case "warning":                                                                                                                                                                                                                        
                            aSeverity.push(sap.ui.core.MessageType.Warning);                                                                                                                                                                                   
                            break;                                                                                                                                                                                                                             
                        default:                                                                                                                                                                                                                               
                            aSeverity.push(sap.ui.core.MessageType.None);                                                                                                                                                                                      
                            break;                                                                                                                                                                                                                             
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // Exibe mensagem                                                                                                                                                                                                                              
                for (let i = 0; i < aMessage.length; i++) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    if (aMessage[i] == "Ocorreu uma exceção") {                                                                                                                                                                                                
                        continue;                                                                                                                                                                                                                              
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    //MessageManager.addMessages(new sap.ui.core.message.Message({                                                                                                                                                                             
                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                                         
                        message: aMessage[i],                                                                                                                                                                                                                  
                        persistent: true, // create message as transition message                                                                                                                                                                              
                        type: aSeverity[i]                                                                                                                                                                                                                     
                    }));                                                                                                                                                                                                                                       
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               