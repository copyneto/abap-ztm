sap.ui.define([],function(){"use strict";return{parseXmlToJson:function(e){const s={};for(const t of e.matchAll(/(?:<(\w*)(?:\s[^>]*)*>)((?:(?!<\1).)*)(?:<\/\1>)|<(\w*)(?:\s*)*\/>/gm)){const e=t[1]||t[3];const a=t[2]&&this.parseXmlToJson(t[2]);s[e]=(a&&O+
bject.keys(a).length?a:t[2])||null}return s},showSuccessMessage:function(e){this.getView().setBusy(false)},showErrorMessage:function(e){this.getView().setBusy(false)},onAgrupar:function(e){var s=this;let t=e.getSource();const a="BR_NotaFiscal";const r="O+
rdemFrete";const n="/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV";const o="/CockpitMDFSet";let i=new sap.ui.model.odata.ODataModel(n,false);let l=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();let u=[];for(let e=0;e<l.length;e++){let s=l[e]+
.getObject();let t=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter(a,sap.ui.model.FilterOperator.EQ,s.BR_NotaFiscal),new sap.ui.model.Filter(r,sap.ui.model.FilterOperator.EQ,s.OrdemFrete)],and:true});u.push(t)}var c=function(){return new Promis+
e(function(e,s){i.read(o,{filters:[new sap.ui.model.Filter(u,false)],success:function(s,t){this.templateBaseExtension.getExtensionAPI().refreshTable();const a=t.headers["sap-message"];const r=JSON.parse(JSON.stringify(a));const n=this.parseXmlToJson(r);s+
ap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({message:n.notification.message,persistent:true,type:sap.ui.core.MessageType.Success}));e()}.bind(this),error:function(e){s();let t=[];for(const s of e.response.body.matchAll+
(/(?:<message>(.*?)<[/]message>)/gm)){t.push(s[1])}for(let e=0;e<t.length;e++){sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({message:t[e],persistent:true,type:sap.ui.core.MessageType.Error}))}}})}.bind(this))}.bind(thi+
s);this.extensionAPI.securedExecution(c,{busy:{set:true,check:false},sActionLabel:t.getText()})},onDesagrupar:function(e){var s=this;let t=e.getSource();const a="BR_NotaFiscal";const r="OrdemFrete";const n="/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV";const o+
="/DesagruparMDFSet";let i=new sap.ui.model.odata.ODataModel(n,false);let l=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();let u=[];for(let e=0;e<l.length;e++){let s=l[e].getObject();let t=new sap.ui.model.Filter({filters:[new sap.ui.+
model.Filter(a,sap.ui.model.FilterOperator.EQ,s.BR_NotaFiscal),new sap.ui.model.Filter(r,sap.ui.model.FilterOperator.EQ,s.OrdemFrete)],and:true});u.push(t)}var c=function(){return new Promise(function(e,s){i.read(o,{filters:[new sap.ui.model.Filter(u,fal+
se)],success:function(s,t){this.templateBaseExtension.getExtensionAPI().refreshTable();const a=t.headers["sap-message"];const r=JSON.parse(JSON.stringify(a));const n=this.parseXmlToJson(r);sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.+
message.Message({message:n.notification.message,persistent:true,type:sap.ui.core.MessageType.Success}));e()}.bind(this),error:function(e){s();let t=[];for(const s of e.response.body.matchAll(/(?:<message>(.*?)<[/]message>)/gm)){t.push(s[1])}for(let e=0;e+
<t.length;e++){sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({message:t[e],persistent:true,type:sap.ui.core.MessageType.Error}))}}})}.bind(this))}.bind(this);this.extensionAPI.securedExecution(c,{busy:{set:true,check:fa+
lse},sActionLabel:t.getText()})},onActionNavigateMDFe:function(e){sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([{target:{shellHash:"ZZ1_MONITOR_MDF-manage"}}]).done(function(e){e.map(function(e,s){if(e.supported===t+
rue){var t=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({target:{semanticObject:"ZZ1_MONITOR_MDF",action:"manage"}});sap.m.URLHelper.redirect(t,false)}else{alert("Usuário sem permissão pa+
ra acessar o link")}})}).fail(function(){alert("Falha ao acessar o link")})},onActionPrint:function(e){let s=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();var t="/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";var a=s.reduce(function(e,s){i+
f(s.getObject().StatusCode=="100"){return e+s.getObject().Guid.toString().replaceAll("-","").toUpperCase()+";"}else{return e}},"");if(!a){alert("Nenhuma MDF-e autorizada foi selecionada");return}var r=t+"downloadSet(Id='"+a+"')/$value";var n=new sap.m.PD+
FViewer;this.getView().addDependent(n);n.setSource(r);n.setTitle("Fomulário");n.open()},onActionCreateMdfUsingFo:function(e){var s=this;var t="usarOfCriarMdfeListaSet(OrdemFrete='')";var a="/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";var r=new sap.ui.model.+
odata.ODataModel(a,false);var n=function(){return new Promise(function(e,s){r.read(t,{success:function(s,t){e();var a=s.OrdemFreteLista.split(";");let r=[];for(let e=0;e<a.length;e++){r.push({FreightOrder:a[e]})}this.generateFileSearchHelp(r)}.bind(this)+
,error:function(e){s();this.showLog(e.response.body)}.bind(this)})}.bind(this))}.bind(this);var o={dataloss:false};this.extensionAPI.securedExecution(n,o)},generateFileSearchHelp:function(e){var s=this;var t=new sap.m.ComboBox({id:"oComboBox",items:{path+
:"/items",template:new sap.ui.core.ListItem({key:"{FreightOrder}",text:"{FreightOrder}"}),templateShareable:false},showSecondaryValues:true});t.setModel(new sap.ui.model.json.JSONModel({items:e}));var a=new sap.ui.layout.VerticalLayout({width:"100%",cont+
ent:[new sap.m.Text({text:"Favor informar a Ordem de Frete utilizada para gerar um novo MDFe."}),new sap.m.Text({text:" "}),t]});var r=new sap.m.Button({type:sap.m.ButtonType.Emphasized,text:"Criar MDFe usando OF",press:function(){var e=sap.ui.getCore().+
byId("oComboBox").getValue();if(!e){alert("Informar Ordem de Frete antes de prosseguir")}else{o.close();s.generateFile(e)}}});var n=new sap.m.Button({text:"Cancelar",type:"Reject",press:function(){o.close();o.destroy();this.getView().removeAllDependents(+
)}.bind(this)});var o=new sap.m.Dialog({type:"Message",title:"Criar MDFe usando OF",resizable:true,draggable:true,titleAlignment:sap.m.TitleAlignment.Center,content:a,beginButton:r,endButton:n,afterClose:function(){o.destroy()},contentWidth:"20%"});o.ope+
n()},generateFile:function(e){var s="usarOfCriarMdfeSet(OrdemFrete='"+e+"')";var t="/sap/opu/odata/SAP/ZTM_MONITOR_MDF_SRV/";var a=new sap.ui.model.odata.ODataModel(t,false);var r=function(){return new Promise(function(e,t){a.read(s,{success:function(s,t+
){e();sap.m.MessageToast.show(s.Message);this.templateBaseExtension.getExtensionAPI().refreshTable()}.bind(this),error:function(e){t();this.showLog(e.response.body);this.templateBaseExtension.getExtensionAPI().refreshTable()}.bind(this)})}.bind(this))}.b+
ind(this);var n={dataloss:false};this.extensionAPI.securedExecution(r,n)},showLog:function(e){let s=[];for(const t of e.matchAll(/(?:<message>(.*?)<[/]message>)/gm)){s.push(t[1])}let t=[];for(const s of e.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)){s+
witch(s[1]){case"error":t.push(sap.ui.core.MessageType.Error);break;case"info":t.push(sap.ui.core.MessageType.Information);break;case"success":t.push(sap.ui.core.MessageType.Success);break;case"warning":t.push(sap.ui.core.MessageType.Warning);break;defau+
lt:t.push(sap.ui.core.MessageType.None);break}}for(let e=0;e<s.length;e++){if(s[e]=="Ocorreu uma exceção"){continue}sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({message:s[e],persistent:true,type:t[e]}))}}}});          